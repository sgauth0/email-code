<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Stella Mail Console (Mock)</title>
  <style>
    :root{
      --bg: #0b0d12;
      --panel: #0f1320;
      --panel2: #0c0f1a;
      --border: rgba(255,255,255,.08);
      --muted: rgba(255,255,255,.65);
      --text: rgba(255,255,255,.92);
      --faint: rgba(255,255,255,.45);
      --shadow: 0 12px 40px rgba(0,0,0,.45);
      --radius: 16px;
      --radius2: 20px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--text);
      background:
        radial-gradient(1200px 700px at 12% 20%, rgba(0,255,255,.07), transparent 55%),
        radial-gradient(1000px 600px at 88% 10%, rgba(255,0,200,.06), transparent 55%),
        radial-gradient(900px 600px at 70% 90%, rgba(0,255,120,.05), transparent 55%),
        linear-gradient(180deg, #090a0f, #0b0d12);
      overflow:hidden;
    }

    /* Layout */
    .app{
      height:100%;
      display:grid;
      grid-template-rows: 56px 1fr;
      gap:12px;
      padding:14px;
    }

    .topbar{
      background: rgba(15,19,32,.72);
      border:1px solid var(--border);
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:10px 12px;
      backdrop-filter: blur(10px);
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 260px;
    }
    .logoDot{
      width:10px;height:10px;border-radius:99px;
      background: linear-gradient(135deg, rgba(0,255,255,.9), rgba(255,0,200,.85));
      box-shadow: 0 0 18px rgba(0,255,255,.25);
    }
    .brandTitle{
      font-family: var(--mono);
      font-size: 13px;
      letter-spacing: .02em;
      color: rgba(255,255,255,.82);
      user-select:none;
    }
    .hint{
      font-size:12px;
      color: var(--faint);
      user-select:none;
    }

    .pills{
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .pill{
      display:flex;
      align-items:center;
      gap:8px;
      padding:7px 10px;
      border-radius: 999px;
      border:1px solid var(--border);
      background: rgba(12,15,26,.55);
      color: rgba(255,255,255,.86);
      cursor:pointer;
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
      user-select:none;
      font-size: 12px;
      line-height: 1;
    }
    .pill:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.16); }
    .pill.active{
      border-color: rgba(255,255,255,.22);
      background: rgba(255,255,255,.06);
    }
    .dot{
      width:10px;height:10px;border-radius:99px;
      box-shadow: 0 0 16px rgba(255,255,255,.10);
    }
    .pill small{ color: var(--faint); font-family: var(--mono); }

    .pill.add{
      padding:7px 10px;
      background: rgba(255,255,255,.04);
      border-style:dashed;
    }

    /* Main grid */
    .main{
      height:100%;
      display:grid;
      grid-template-columns: 290px 1fr 520px;
      gap:12px;
      min-height:0;
    }

    .panel{
      background: rgba(15,19,32,.70);
      border:1px solid var(--border);
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      min-height:0;
      overflow:hidden;
    }

    .panelHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:12px 12px 10px 12px;
      border-bottom:1px solid rgba(255,255,255,.07);
      background: rgba(10,12,18,.35);
    }
    .panelHeader .title{
      font-family: var(--mono);
      font-size: 12px;
      letter-spacing: .04em;
      color: rgba(255,255,255,.78);
      text-transform: lowercase;
    }
    .panelHeader .actions{
      display:flex;
      gap:8px;
    }

    .btn{
      font-size:12px;
      border-radius: 10px;
      padding:7px 10px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: rgba(255,255,255,.84);
      cursor:pointer;
      transition: border-color .12s ease, background .12s ease, transform .12s ease;
      user-select:none;
    }
    .btn:hover{ border-color: rgba(255,255,255,.18); background: rgba(255,255,255,.06); transform: translateY(-1px); }
    .btn.primary{ background: rgba(0,255,255,.10); border-color: rgba(0,255,255,.20); }
    .btn.danger{ background: rgba(255,80,120,.10); border-color: rgba(255,80,120,.22); }
    .btn.ghost{ background: transparent; }

    /* Sidebar folders */
    .sidebar{
      display:flex;
      flex-direction:column;
      height:100%;
    }
    .folderList{
      padding:8px;
      overflow:auto;
    }
    .folder{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:9px 10px;
      border-radius: 14px;
      cursor:pointer;
      border:1px solid transparent;
      color: rgba(255,255,255,.84);
      transition: background .12s ease, border-color .12s ease;
      user-select:none;
    }
    .folder:hover{ background: rgba(255,255,255,.04); border-color: rgba(255,255,255,.08); }
    .folder.active{ background: rgba(255,255,255,.06); border-color: rgba(255,255,255,.12); }
    .folder .left{
      display:flex; align-items:center; gap:10px;
    }
    .folder .icon{
      width:22px;height:22px;border-radius: 9px;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.07);
      display:grid; place-items:center;
      font-size: 12px;
      color: rgba(255,255,255,.7);
      font-family: var(--mono);
    }
    .folder .label{
      font-size: 13px;
    }
    .folder .count{
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(255,255,255,.55);
      background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.08);
      padding:3px 7px;
      border-radius: 999px;
    }
    details.advanced{
      margin-top:6px;
      border-top:1px solid rgba(255,255,255,.06);
      padding-top:8px;
    }
    details.advanced summary{
      cursor:pointer;
      color: rgba(255,255,255,.62);
      font-size:12px;
      font-family: var(--mono);
      padding:8px 10px;
      border-radius: 12px;
      list-style:none;
      user-select:none;
    }
    details.advanced summary:hover{ background: rgba(255,255,255,.03); }

    /* Inbox */
    .inbox{
      display:flex;
      flex-direction:column;
      height:100%;
      min-height:0;
    }
    .searchRow{
      padding:10px 12px;
      border-bottom:1px solid rgba(255,255,255,.07);
      display:flex;
      gap:10px;
      align-items:center;
      background: rgba(10,12,18,.25);
    }
    .search{
      flex:1;
      display:flex;
      align-items:center;
      gap:10px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      border-radius: 14px;
      padding:9px 10px;
    }
    .search input{
      flex:1;
      border:0;
      outline:none;
      background: transparent;
      color: rgba(255,255,255,.90);
      font-size: 13px;
    }
    .search .kbd{
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(255,255,255,.55);
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      padding:2px 6px;
      border-radius: 8px;
      user-select:none;
    }

    .threadList{
      overflow:auto;
      padding:8px;
      min-height:0;
    }
    .thread{
      display:grid;
      grid-template-columns: 12px 1fr auto;
      gap:10px;
      padding:10px 10px;
      border-radius: 16px;
      border:1px solid transparent;
      cursor:pointer;
      transition: background .12s ease, border-color .12s ease, transform .12s ease;
      user-select:none;
    }
    .thread:hover{ background: rgba(255,255,255,.04); border-color: rgba(255,255,255,.08); transform: translateY(-1px); }
    .thread.active{ background: rgba(255,255,255,.06); border-color: rgba(255,255,255,.12); }
    .acctChip{
      width:10px;height:10px;border-radius: 99px; margin-top:5px;
      box-shadow: 0 0 16px rgba(255,255,255,.10);
    }
    .threadMain{
      min-width:0;
    }
    .threadTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .from{
      font-size: 13px;
      color: rgba(255,255,255,.88);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      min-width:0;
    }
    .meta{
      display:flex;
      align-items:center;
      gap:8px;
      color: rgba(255,255,255,.55);
      font-family: var(--mono);
      font-size: 11px;
      white-space:nowrap;
    }
    .badge{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      padding:2px 6px;
      border-radius: 999px;
      color: rgba(255,255,255,.65);
    }
    .subject{
      margin-top:4px;
      font-size: 13px;
      color: rgba(255,255,255,.84);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .preview{
      margin-top:3px;
      font-size: 12px;
      color: rgba(255,255,255,.55);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .unreadDot{
      width:8px;height:8px;border-radius:99px;
      background: rgba(0,255,255,.85);
      box-shadow: 0 0 14px rgba(0,255,255,.25);
      margin-top:6px;
      visibility:hidden;
    }
    .thread.unread .unreadDot{ visibility:visible; }

    /* Thread view */
    .reader{
      display:flex;
      flex-direction:column;
      height:100%;
      min-height:0;
    }
    .readerTop{
      padding:12px;
      border-bottom:1px solid rgba(255,255,255,.07);
      background: rgba(10,12,18,.25);
    }
    .readerSubject{
      font-size: 16px;
      color: rgba(255,255,255,.92);
      margin-bottom:10px;
      line-height: 1.25;
    }
    .readerMetaRow{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
      color: rgba(255,255,255,.60);
      font-size: 12px;
    }
    .bigPill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(255,255,255,.80);
    }
    .bigPill .dot{ width:10px;height:10px; }
    .readerActions{
      margin-top:10px;
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }

    .messageList{
      padding:12px;
      overflow:auto;
      min-height:0;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .msg{
      border:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.18);
      border-radius: 16px;
      padding:10px 10px 12px 10px;
    }
    .msgHeader{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
    }
    .msgFrom{
      font-size: 12px;
      color: rgba(255,255,255,.86);
      font-family: var(--mono);
    }
    .msgTo{
      margin-top:4px;
      font-size: 11px;
      color: rgba(255,255,255,.55);
      font-family: var(--mono);
    }
    .msgDate{
      font-size: 11px;
      color: rgba(255,255,255,.55);
      font-family: var(--mono);
      white-space:nowrap;
    }
    .msgBody{
      margin-top:10px;
      font-size: 13px;
      color: rgba(255,255,255,.78);
      line-height: 1.45;
      white-space: pre-wrap;
    }

    /* Compose drawer */
    .compose{
      position: fixed;
      left: 14px;
      right: 14px;
      bottom: 14px;
      border-radius: 22px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(12,15,26,.82);
      box-shadow: 0 18px 70px rgba(0,0,0,.55);
      backdrop-filter: blur(12px);
      transform: translateY(calc(100% + 24px));
      transition: transform .18s ease;
      overflow:hidden;
      max-width: 1280px;
      margin: 0 auto;
    }
    .compose.open{
      transform: translateY(0);
    }
    .composeHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:10px 12px;
      border-bottom:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.18);
      gap:10px;
    }
    .sendingAs{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 0;
    }
    .sendingLabel{
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(255,255,255,.75);
      letter-spacing: .03em;
      user-select:none;
    }
    .senderSelect{
      display:flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      cursor:pointer;
      user-select:none;
      min-width: 0;
    }
    .senderSelect strong{
      font-family: var(--mono);
      font-size: 12px;
      font-weight: 600;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 420px;
    }
    .warn{
      border-color: rgba(255,180,0,.35) !important;
      background: rgba(255,180,0,.08) !important;
    }
    .composeBody{
      padding:12px;
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    .fieldRow{
      display:grid;
      grid-template-columns: 70px 1fr;
      gap:10px;
      align-items:center;
    }
    .fieldRow label{
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(255,255,255,.60);
      user-select:none;
    }
    .fieldRow input{
      width:100%;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color: rgba(255,255,255,.88);
      padding:10px 12px;
      border-radius: 14px;
      outline:none;
      font-size: 13px;
    }
    textarea{
      width:100%;
      min-height: 120px;
      resize: vertical;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color: rgba(255,255,255,.88);
      padding:12px;
      border-radius: 16px;
      outline:none;
      font-size: 13px;
      line-height: 1.45;
      font-family: var(--sans);
    }
    .composeFooter{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:10px 12px 12px 12px;
      border-top:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.12);
      gap:10px;
      flex-wrap:wrap;
    }
    .miniHelp{
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(255,255,255,.55);
      user-select:none;
    }

    /* Account picker popover */
    .popover{
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 210px;
      width: min(560px, calc(100% - 28px));
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(12,15,26,.92);
      box-shadow: 0 18px 70px rgba(0,0,0,.60);
      backdrop-filter: blur(12px);
      padding: 10px;
      display:none;
      z-index: 50;
    }
    .popover.open{ display:block; }
    .popTitle{
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(255,255,255,.60);
      padding: 8px 8px 10px 8px;
      user-select:none;
    }
    .popGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:8px;
    }
    .popItem{
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      padding:10px;
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
      display:flex;
      gap:10px;
      align-items:flex-start;
      min-width:0;
    }
    .popItem:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.05);
      border-color: rgba(255,255,255,.16);
    }
    .popItem .meta{
      display:flex;
      flex-direction:column;
      gap:4px;
      min-width:0;
    }
    .popItem .name{
      font-size: 13px;
      color: rgba(255,255,255,.88);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      min-width:0;
    }
    .popItem .email{
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(255,255,255,.55);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      min-width:0;
    }

    /* Responsive */
    @media (max-width: 1200px){
      .main{ grid-template-columns: 280px 1fr; }
      .panel.readerPanel{ display:none; }
    }
    @media (max-width: 860px){
      .main{ grid-template-columns: 1fr; }
      .panel.sidebarPanel{ display:none; }
      .topbar{ gap:10px; }
      .brand{ min-width: 0; }
      .hint{ display:none; }
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="topbar">
      <div class="brand">
        <div class="logoDot"></div>
        <div>
          <div class="brandTitle">mail.console</div>
          <div class="hint">folders first • unified inbox • zero regrets</div>
        </div>
      </div>

      <div class="pills" id="accountPills"></div>
    </div>

    <div class="main">
      <!-- Sidebar -->
      <div class="panel sidebarPanel sidebar">
        <div class="panelHeader">
          <div class="title">folders</div>
          <div class="actions">
            <button class="btn ghost" id="btnCollapseAdvanced">advanced</button>
          </div>
        </div>

        <div class="folderList" id="folderList"></div>
      </div>

      <!-- Inbox -->
      <div class="panel inboxPanel inbox">
        <div class="panelHeader">
          <div class="title" id="inboxTitle">unified inbox</div>
          <div class="actions">
            <button class="btn" id="btnCompose">compose</button>
            <button class="btn primary" id="btnSimulate">simulate sync</button>
          </div>
        </div>

        <div class="searchRow">
          <div class="search">
            <span style="font-family:var(--mono); color:rgba(255,255,255,.55)">/</span>
            <input id="searchInput" placeholder="Search: sender, subject, anything..." />
            <span class="kbd">ctrl</span><span class="kbd">k</span>
          </div>
          <button class="btn" id="btnMarkRead">toggle read</button>
          <button class="btn danger" id="btnTrash">trash</button>
        </div>

        <div class="threadList" id="threadList"></div>
      </div>

      <!-- Reader -->
      <div class="panel readerPanel reader">
        <div class="panelHeader">
          <div class="title">thread</div>
          <div class="actions">
            <button class="btn" id="btnArchive">archive</button>
            <button class="btn" id="btnMove">move</button>
            <button class="btn danger" id="btnDelete">delete</button>
          </div>
        </div>

        <div class="readerTop">
          <div class="readerSubject" id="readerSubject">Select a thread</div>
          <div class="readerMetaRow" id="readerMetaRow"></div>
          <div class="readerActions" id="readerActions" style="display:none;">
            <button class="btn" id="btnReply">reply</button>
            <button class="btn" id="btnReplyAll">reply all</button>
            <button class="btn" id="btnForward">forward</button>
          </div>
        </div>

        <div class="messageList" id="messageList"></div>
      </div>
    </div>
  </div>

  <!-- Compose Drawer -->
  <div class="compose" id="composeDrawer" aria-hidden="true">
    <div class="composeHeader">
      <div class="sendingAs">
        <div class="sendingLabel">SENDING AS</div>
        <div class="senderSelect" id="senderSelect" title="Click to switch sender">
          <span class="dot" id="senderDot"></span>
          <strong id="senderText">basic • stellag100@gmail.com</strong>
          <span style="font-family:var(--mono); color:rgba(255,255,255,.55);">▾</span>
        </div>
      </div>
      <div style="display:flex; gap:8px; align-items:center;">
        <button class="btn ghost" id="btnCloseCompose">close</button>
        <button class="btn primary" id="btnSend">send</button>
      </div>
    </div>

    <div class="composeBody">
      <div class="fieldRow">
        <label>to</label>
        <input id="composeTo" placeholder="someone@somewhere.com" />
      </div>
      <div class="fieldRow">
        <label>subj</label>
        <input id="composeSubj" placeholder="Subject that won't haunt you later" />
      </div>
      <textarea id="composeBody" placeholder="Type your message. Be normal. Or don't."></textarea>
    </div>

    <div class="composeFooter">
      <div class="miniHelp">Shortcuts: <b style="color:rgba(255,255,255,.75); font-family:var(--mono)">j/k</b> navigate, <b style="color:rgba(255,255,255,.75); font-family:var(--mono)">enter</b> open, <b style="color:rgba(255,255,255,.75); font-family:var(--mono)">r</b> reply, <b style="color:rgba(255,255,255,.75); font-family:var(--mono)">c</b> compose</div>
      <div class="miniHelp">Dev mock. No IMAP harmed in the making of this file.</div>
    </div>
  </div>

  <!-- Sender picker -->
  <div class="popover" id="senderPopover">
    <div class="popTitle">pick sender identity</div>
    <div class="popGrid" id="senderGrid"></div>
  </div>

<script>
  // ---------- Sample Data ----------
  const accounts = [
    { id: "basic", label: "basic", email: "stellag100@gmail.com", color: "#00F0FF" },
    { id: "work",  label: "work",  email: "stella.work@gmail.com", color: "#FF3BD6" },
    { id: "alt",   label: "alt",   email: "stella.alt@gmail.com",  color: "#3BFF8B" },
    { id: "trash", label: "trash", email: "stella.aux+signups@gmail.com", color: "#FFC247" },
  ];

  const foldersCore = [
    { id: "inbox", label: "Inbox", icon: "I" },
    { id: "sent", label: "Sent", icon: "S" },
    { id: "drafts", label: "Drafts", icon: "D" },
    { id: "archive", label: "Archive", icon: "A" },
    { id: "projects", label: "Projects", icon: "P" },
    { id: "newsletters", label: "Newsletters", icon: "N" },
  ];
  const foldersAdvanced = [
    { id: "advanced_allmail", label: "[Gmail] All Mail", icon: "∞" },
    { id: "advanced_spam", label: "[Gmail] Spam", icon: "!" },
    { id: "advanced_trash", label: "[Gmail] Trash", icon: "×" },
  ];

  function makeMsg(from, to, date, body){
    return { id: crypto.randomUUID(), from, to, date, body };
  }

  // Thread "folderId" is primary view label for the mock.
  let threads = [
    {
      id: "t1",
      accountId: "basic",
      folderId: "inbox",
      from: "Namecheap",
      subject: "Your domain renewal is coming up",
      preview: "Heads up: renewal in 14 days. Update payment method if needed.",
      time: "10:42",
      unread: true,
      messages: [
        makeMsg("Namecheap <support@namecheap.com>", "stellag100@gmail.com", "Jan 14, 2026 10:42", "Heads up: your domain renewal is coming up.\n\nRenewal date: Jan 28\nAuto-renew: ON\n\nThis is a mock email, relax."),
      ],
    },
    {
      id: "t2",
      accountId: "work",
      folderId: "inbox",
      from: "CI Bot",
      subject: "Build failed: lint errors in inbox renderer",
      preview: "12 warnings, 1 error. The error is real, the bot is not.",
      time: "09:18",
      unread: true,
      messages: [
        makeMsg("CI Bot <ci@work.local>", "stella.work@gmail.com", "Jan 14, 2026 09:18", "Build failed.\n\n- 12 warnings\n- 1 error\n\nError: Unused variable 'labels' (it is always labels)."),
        makeMsg("You", "CI Bot <ci@work.local>", "Jan 14, 2026 09:19", "I will fix it when the universe stops testing me."),
      ],
    },
    {
      id: "t3",
      accountId: "alt",
      folderId: "projects",
      from: "Stella (you)",
      subject: "Email console notes",
      preview: "Account pills, folder-first, sender safety, cache layer later.",
      time: "Yesterday",
      unread: false,
      messages: [
        makeMsg("Stella <stella.alt@gmail.com>", "Stella <stella.alt@gmail.com>", "Jan 13, 2026 23:44", "Notes:\n- Unified inbox is a view, not a folder\n- Account chip must be obvious\n- SENDING AS pill must be huge\n- No AI until it actually helps"),
      ],
    },
    {
      id: "t4",
      accountId: "trash",
      folderId: "newsletters",
      from: "Some Newsletter",
      subject: "The 47th productivity method you won't use",
      preview: "This one totally works, just wake at 4AM and hate yourself.",
      time: "Mon",
      unread: false,
      messages: [
        makeMsg("newsletter@meh.com", "stella.aux+signups@gmail.com", "Jan 12, 2026 08:01", "Wake up at 4am. Journal. Cold plunge. Eat gravel. Become unstoppable.\n\nUnsubscribe link: (mock)"),
      ],
    },
    {
      id: "t5",
      accountId: "basic",
      folderId: "inbox",
      from: "Friend",
      subject: "are we hanging out later",
      preview: "also i found that meme you like (unfortunately)",
      time: "08:03",
      unread: false,
      messages: [
        makeMsg("Friend <friend@internet.com>", "stellag100@gmail.com", "Jan 14, 2026 08:03", "are we hanging out later\n\nalso i found that meme you like"),
      ],
    },
  ];

  // ---------- State ----------
  let state = {
    accountScope: "all", // "all" or AccountId
    folderScope: "inbox", // FolderId
    selectedThreadId: null,
    search: "",
    composeOpen: false,
    senderAccountId: "basic",
    senderWarn: false,
    advancedOpen: false,
  };

  // ---------- DOM ----------
  const elAccountPills = document.getElementById("accountPills");
  const elFolderList = document.getElementById("folderList");
  const elThreadList = document.getElementById("threadList");
  const elInboxTitle = document.getElementById("inboxTitle");

  const elReaderSubject = document.getElementById("readerSubject");
  const elReaderMetaRow = document.getElementById("readerMetaRow");
  const elReaderActions = document.getElementById("readerActions");
  const elMessageList = document.getElementById("messageList");

  const elSearchInput = document.getElementById("searchInput");

  const elCompose = document.getElementById("composeDrawer");
  const elSenderSelect = document.getElementById("senderSelect");
  const elSenderDot = document.getElementById("senderDot");
  const elSenderText = document.getElementById("senderText");
  const elSenderPopover = document.getElementById("senderPopover");
  const elSenderGrid = document.getElementById("senderGrid");

  // Buttons
  const btnCompose = document.getElementById("btnCompose");
  const btnCloseCompose = document.getElementById("btnCloseCompose");
  const btnSend = document.getElementById("btnSend");
  const btnSimulate = document.getElementById("btnSimulate");
  const btnMarkRead = document.getElementById("btnMarkRead");
  const btnTrash = document.getElementById("btnTrash");
  const btnArchive = document.getElementById("btnArchive");
  const btnMove = document.getElementById("btnMove");
  const btnDelete = document.getElementById("btnDelete");
  const btnReply = document.getElementById("btnReply");
  const btnReplyAll = document.getElementById("btnReplyAll");
  const btnForward = document.getElementById("btnForward");
  const btnCollapseAdvanced = document.getElementById("btnCollapseAdvanced");

  // ---------- Helpers ----------
  function acctById(id){ return accounts.find(a => a.id === id); }
  function setDotColor(dotEl, color){ dotEl.style.background = color; }

  function filteredThreads(){
    const q = state.search.trim().toLowerCase();
    return threads
      .filter(t => state.accountScope === "all" ? true : t.accountId === state.accountScope)
      .filter(t => t.folderId === state.folderScope)
      .filter(t => {
        if (!q) return true;
        return (
          t.from.toLowerCase().includes(q) ||
          t.subject.toLowerCase().includes(q) ||
          t.preview.toLowerCase().includes(q)
        );
      })
      .sort((a,b) => (a.unread === b.unread) ? 0 : (a.unread ? -1 : 1));
  }

  function ensureSelection(){
    const list = filteredThreads();
    if (!state.selectedThreadId && list.length) state.selectedThreadId = list[0].id;
    if (state.selectedThreadId && !list.some(t => t.id === state.selectedThreadId)){
      state.selectedThreadId = list.length ? list[0].id : null;
    }
  }

  function selectedThread(){
    return threads.find(t => t.id === state.selectedThreadId) || null;
  }

  // ---------- Render ----------
  function renderAccountPills(){
    elAccountPills.innerHTML = "";

    const makePill = (label, sub, color, active, onClick, extraClass="") => {
      const d = document.createElement("div");
      d.className = `pill ${active ? "active" : ""} ${extraClass}`.trim();
      d.innerHTML = `<span class="dot"></span><span>${label}</span><small>${sub || ""}</small>`;
      setDotColor(d.querySelector(".dot"), color);
      d.addEventListener("click", onClick);
      return d;
    };

    // All accounts pill
    const allActive = state.accountScope === "all";
    elAccountPills.appendChild(
      makePill("all", "unified", "rgba(255,255,255,.55)", allActive, () => {
        state.accountScope = "all";
        // unified account scope, folder still applies
        ensureSelection();
        render();
      })
    );

    // Each account
    for (const a of accounts){
      const active = state.accountScope === a.id;
      elAccountPills.appendChild(
        makePill(a.label, a.email, a.color, active, () => {
          state.accountScope = a.id;
          ensureSelection();
          render();
        })
      );
    }

    // Add pill (mock)
    const add = document.createElement("div");
    add.className = "pill add";
    add.textContent = "+ add";
    add.title = "Mock: add account (no OAuth here)";
    add.addEventListener("click", () => {
      alert("Mock: this would start OAuth and add a Gmail account.\n\nFor now, pretend you did it and feel productive.");
    });
    elAccountPills.appendChild(add);
  }

  function renderFolders(){
    elFolderList.innerHTML = "";

    const makeFolder = (f, count) => {
      const row = document.createElement("div");
      row.className = "folder " + (state.folderScope === f.id ? "active" : "");
      row.innerHTML = `
        <div class="left">
          <div class="icon">${f.icon}</div>
          <div class="label">${f.label}</div>
        </div>
        <div class="count">${count}</div>
      `;
      row.addEventListener("click", () => {
        state.folderScope = f.id;
        ensureSelection();
        render();
      });
      return row;
    };

    // counts
    const countFor = (folderId) =>
      threads.filter(t =>
        (state.accountScope === "all" ? true : t.accountId === state.accountScope) &&
        t.folderId === folderId
      ).length;

    // core + custom
    for (const f of foldersCore){
      elFolderList.appendChild(makeFolder(f, countFor(f.id)));
    }

    const details = document.createElement("details");
    details.className = "advanced";
    details.open = state.advancedOpen;
    const summary = document.createElement("summary");
    summary.textContent = "advanced system folders";
    summary.addEventListener("click", (e) => {
      // Let details toggle happen, then sync state after paint
      setTimeout(() => {
        state.advancedOpen = details.open;
      }, 0);
    });
    details.appendChild(summary);

    const advWrap = document.createElement("div");
    advWrap.style.padding = "0 0 6px 0";
    advWrap.style.marginTop = "4px";

    for (const f of foldersAdvanced){
      advWrap.appendChild(makeFolder(f, countFor(f.id)));
    }

    details.appendChild(advWrap);
    elFolderList.appendChild(details);
  }

  function renderInboxTitle(){
    const acctLabel = (state.accountScope === "all")
      ? "unified"
      : acctById(state.accountScope).label;

    const folderLabel =
      [...foldersCore, ...foldersAdvanced].find(f => f.id === state.folderScope)?.label || state.folderScope;

    elInboxTitle.textContent = `${acctLabel} • ${folderLabel}`.toLowerCase();
  }

  function renderThreadList(){
    elThreadList.innerHTML = "";
    const list = filteredThreads();

    if (!list.length){
      const empty = document.createElement("div");
      empty.style.padding = "18px 14px";
      empty.style.color = "rgba(255,255,255,.55)";
      empty.style.fontFamily = "var(--mono)";
      empty.style.fontSize = "12px";
      empty.textContent = "No threads here. Peaceful. Suspicious, even.";
      elThreadList.appendChild(empty);
      return;
    }

    for (const t of list){
      const row = document.createElement("div");
      row.className = "thread " +
        (t.id === state.selectedThreadId ? "active " : "") +
        (t.unread ? "unread" : "");

      const acct = acctById(t.accountId);

      row.innerHTML = `
        <div class="acctChip"></div>
        <div class="threadMain">
          <div class="threadTop">
            <div class="from">${escapeHtml(t.from)}</div>
            <div class="meta">
              <span>${escapeHtml(t.time)}</span>
              <span class="badge">${escapeHtml(acct.label)}</span>
            </div>
          </div>
          <div class="subject">${escapeHtml(t.subject)}</div>
          <div class="preview">${escapeHtml(t.preview)}</div>
        </div>
        <div class="unreadDot"></div>
      `;

      setDotColor(row.querySelector(".acctChip"), acct.color);

      row.addEventListener("click", () => {
        state.selectedThreadId = t.id;
        // set sender default to receiving account if compose is opened for reply later
        render();
      });

      elThreadList.appendChild(row);
    }
  }

  function renderReader(){
    const t = selectedThread();

    elReaderMetaRow.innerHTML = "";
    elMessageList.innerHTML = "";

    if (!t){
      elReaderSubject.textContent = "Select a thread";
      elReaderActions.style.display = "none";
      return;
    }

    const acct = acctById(t.accountId);
    elReaderSubject.textContent = t.subject;

    const metaBits = document.createElement("div");
    metaBits.className = "readerMetaRow";
    metaBits.innerHTML = `
      <span class="bigPill"><span class="dot"></span> ${escapeHtml(acct.label)} • ${escapeHtml(acct.email)}</span>
      <span class="bigPill">folder: ${escapeHtml(folderLabel(t.folderId).toLowerCase())}</span>
      <span class="bigPill">${t.unread ? "unread" : "read"}</span>
    `;
    const dot = metaBits.querySelector(".dot");
    setDotColor(dot, acct.color);
    elReaderMetaRow.appendChild(metaBits);

    elReaderActions.style.display = "flex";

    for (const m of t.messages){
      const card = document.createElement("div");
      card.className = "msg";
      card.innerHTML = `
        <div class="msgHeader">
          <div>
            <div class="msgFrom">${escapeHtml(m.from)}</div>
            <div class="msgTo">to: ${escapeHtml(m.to)}</div>
          </div>
          <div class="msgDate">${escapeHtml(m.date)}</div>
        </div>
        <div class="msgBody">${escapeHtml(m.body)}</div>
      `;
      elMessageList.appendChild(card);
    }
  }

  function renderSenderUI(){
    const a = acctById(state.senderAccountId);
    setDotColor(elSenderDot, a.color);
    elSenderText.textContent = `${a.label} • ${a.email}`;
    elSenderSelect.classList.toggle("warn", state.senderWarn);
  }

  function renderSenderPopover(){
    elSenderGrid.innerHTML = "";
    for (const a of accounts){
      const item = document.createElement("div");
      item.className = "popItem";
      item.innerHTML = `
        <span class="dot"></span>
        <div class="meta">
          <div class="name">${escapeHtml(a.label)}</div>
          <div class="email">${escapeHtml(a.email)}</div>
        </div>
      `;
      setDotColor(item.querySelector(".dot"), a.color);

      item.addEventListener("click", () => {
        // warn if sender differs from thread's account
        const t = selectedThread();
        state.senderAccountId = a.id;
        state.senderWarn = !!(t && t.accountId !== a.id);
        closeSenderPopover();
        renderSenderUI();
      });

      elSenderGrid.appendChild(item);
    }
  }

  function renderCompose(){
    elCompose.classList.toggle("open", state.composeOpen);
    elCompose.setAttribute("aria-hidden", state.composeOpen ? "false" : "true");
    if (state.composeOpen){
      renderSenderUI();
      renderSenderPopover();
    } else {
      closeSenderPopover();
    }
  }

  function render(){
    ensureSelection();
    renderAccountPills();
    renderFolders();
    renderInboxTitle();
    renderThreadList();
    renderReader();
    renderCompose();
  }

  // ---------- Actions ----------
  function toggleCompose(open){
    state.composeOpen = (open !== undefined) ? open : !state.composeOpen;

    if (state.composeOpen){
      // Default sender to current thread's account (reply safety)
      const t = selectedThread();
      if (t) {
        state.senderAccountId = t.accountId;
        state.senderWarn = false;
      } else {
        state.senderAccountId = state.accountScope === "all" ? "basic" : state.accountScope;
        state.senderWarn = false;
      }
      // Light prefill on reply (optional)
      document.getElementById("composeTo").value = t ? (acctById(t.accountId).email) : "";
      document.getElementById("composeSubj").value = t ? ("Re: " + t.subject) : "";
      document.getElementById("composeBody").value = t ? "\n\n---\n(quoted content hidden in mock)" : "";
    }
    renderCompose();
  }

  function markSelectedReadToggle(){
    const t = selectedThread();
    if (!t) return;
    t.unread = !t.unread;
    render();
  }

  function moveSelected(toFolderId){
    const t = selectedThread();
    if (!t) return;
    t.folderId = toFolderId;
    render();
  }

  function archiveSelected(){
    // Archive = move out of Inbox
    const t = selectedThread();
    if (!t) return;
    if (t.folderId === "inbox") t.folderId = "archive";
    render();
  }

  function trashSelected(){
    const t = selectedThread();
    if (!t) return;
    t.folderId = "advanced_trash";
    render();
  }

  function deleteSelected(){
    const t = selectedThread();
    if (!t) return;
    threads = threads.filter(x => x.id !== t.id);
    state.selectedThreadId = null;
    render();
  }

  function simulateSync(){
    // Add a new thread to inbox for a random account in current scope.
    const scopeAccounts = state.accountScope === "all"
      ? accounts
      : accounts.filter(a => a.id === state.accountScope);

    const a = scopeAccounts[Math.floor(Math.random() * scopeAccounts.length)];
    const id = crypto.randomUUID();

    const subjectPool = [
      "Verification code (mock)",
      "Your receipt is ready",
      "Deployment complete (probably)",
      "Someone replied to your thing",
      "Scheduled maintenance notice",
    ];
    const fromPool = [
      "NoReply Service",
      "Build System",
      "Friend of a Friend",
      "Platform Team",
      "Internet Person",
    ];

    const subj = subjectPool[Math.floor(Math.random() * subjectPool.length)];
    const from = fromPool[Math.floor(Math.random() * fromPool.length)];
    const t = {
      id,
      accountId: a.id,
      folderId: "inbox",
      from,
      subject: subj,
      preview: "New mail arrived. It's a mock, but your dopamine doesn't know that.",
      time: "now",
      unread: true,
      messages: [
        makeMsg(`${from} <noreply@mock.test>`, a.email, "Jan 14, 2026 11:59", "This is a simulated sync event.\n\nIn real life, IMAP will do this and also occasionally ruin your day."),
      ],
    };
    threads.unshift(t);
    state.selectedThreadId = t.id;
    render();
  }

  function folderLabel(folderId){
    return [...foldersCore, ...foldersAdvanced].find(f => f.id === folderId)?.label || folderId;
  }

  function escapeHtml(str){
    return String(str)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  // ---------- Sender popover ----------
  function openSenderPopover(){
    elSenderPopover.classList.add("open");
  }
  function closeSenderPopover(){
    elSenderPopover.classList.remove("open");
  }

  // ---------- Events ----------
  elSearchInput.addEventListener("input", (e) => {
    state.search = e.target.value || "";
    ensureSelection();
    renderThreadList();
    renderReader();
  });

  btnCompose.addEventListener("click", () => toggleCompose(true));
  btnCloseCompose.addEventListener("click", () => toggleCompose(false));
  btnSend.addEventListener("click", () => {
    alert("Mock send.\n\nIn the real app this would SMTP/API-send from the selected identity.\nAlso: yes, you chose the sender on purpose. We all saw it.");
    toggleCompose(false);
  });

  btnSimulate.addEventListener("click", simulateSync);
  btnMarkRead.addEventListener("click", markSelectedReadToggle);
  btnTrash.addEventListener("click", trashSelected);

  btnArchive.addEventListener("click", archiveSelected);
  btnMove.addEventListener("click", () => {
    const choice = prompt("Move to folder: inbox, archive, projects, newsletters\n(or advanced_allmail / advanced_spam / advanced_trash)", "projects");
    if (!choice) return;
    moveSelected(choice.trim());
  });
  btnDelete.addEventListener("click", () => {
    if (confirm("Delete this thread (mock delete)?")) deleteSelected();
  });

  btnReply.addEventListener("click", () => toggleCompose(true));
  btnReplyAll.addEventListener("click", () => toggleCompose(true));
  btnForward.addEventListener("click", () => toggleCompose(true));

  elSenderSelect.addEventListener("click", () => {
    elSenderPopover.classList.contains("open") ? closeSenderPopover() : openSenderPopover();
  });

  btnCollapseAdvanced.addEventListener("click", () => {
    state.advancedOpen = !state.advancedOpen;
    renderFolders();
  });

  // Close sender popover on outside click
  document.addEventListener("click", (e) => {
    const within = elSenderPopover.contains(e.target) || elSenderSelect.contains(e.target);
    if (!within) closeSenderPopover();
  });

  // Keyboard shortcuts (minimal)
  document.addEventListener("keydown", (e) => {
    const tag = (e.target && e.target.tagName) ? e.target.tagName.toLowerCase() : "";
    const isTyping = tag === "input" || tag === "textarea";

    // Ctrl+K focus search
    if (e.ctrlKey && e.key.toLowerCase() === "k"){
      e.preventDefault();
      elSearchInput.focus();
      return;
    }

    if (isTyping) return;

    const list = filteredThreads();
    const idx = list.findIndex(t => t.id === state.selectedThreadId);

    if (e.key === "j"){
      e.preventDefault();
      if (idx < list.length - 1){
        state.selectedThreadId = list[idx + 1].id;
        renderReader();
        renderThreadList();
      }
    } else if (e.key === "k"){
      e.preventDefault();
      if (idx > 0){
        state.selectedThreadId = list[idx - 1].id;
        renderReader();
        renderThreadList();
      }
    } else if (e.key === "Enter"){
      e.preventDefault();
      // open reader is already open; just mark as read on enter
      const t = selectedThread();
      if (t) { t.unread = false; render(); }
    } else if (e.key.toLowerCase() === "r"){
      e.preventDefault();
      toggleCompose(true);
    } else if (e.key.toLowerCase() === "c"){
      e.preventDefault();
      toggleCompose(true);
    } else if (e.key.toLowerCase() === "e"){
      e.preventDefault();
      archiveSelected();
    } else if (e.key === "#"){
      e.preventDefault();
      trashSelected();
    } else if (e.key === "Escape"){
      if (state.composeOpen) toggleCompose(false);
      closeSenderPopover();
    }
  });

  // Initial render
  render();
</script>
</body>
</html>
